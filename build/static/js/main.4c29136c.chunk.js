(this["webpackJsonpinstagram-clone"]=this["webpackJsonpinstagram-clone"]||[]).push([[0],{69:function(e,t,a){e.exports=a(98)},74:function(e,t,a){},75:function(e,t,a){},76:function(e,t,a){},77:function(e,t,a){},89:function(e,t,a){},95:function(e,t,a){},96:function(e,t,a){},97:function(e,t,a){},98:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),o=a(12),l=a.n(o),r=(a(74),a(75),a(5)),s=(a(76),a(77),a(126)),i=a(24),m=a.n(i),u=m.a.initializeApp({apiKey:"AIzaSyCZ7SX_2NwAxflElWcWaOe7QuqBk2oXRvk",authDomain:"cap-this.firebaseapp.com",databaseURL:"https://cap-this-default-rtdb.firebaseio.com",projectId:"cap-this",storageBucket:"cap-this.appspot.com",messagingSenderId:"357983648624",appId:"1:357983648624:web:fa4a414168ee3a9317edb5",measurementId:"G-2C4QFNL1B1"}).firestore(),p=m.a.auth(),d=m.a.storage(),f=a(48),g=a.n(f),h=a(60),E=a.n(h),b=a(59),v=a.n(b),_=a(61),j=a.n(_),O=a(62),N=a.n(O),S=a(63),y=a.n(S),k=a(118);a(89);var w=function(e){var t=e.commentId,a=e.postId,n=e.curUserName,o=e.username,l=e.text;return c.a.createElement("div",{className:"comment",key:"comment.id"},c.a.createElement("div",null,c.a.createElement("b",null,o)," ",l),n===o?c.a.createElement(k.a,{color:"primary","aria-label":"upload picture",component:"span",className:"delete-comment"},c.a.createElement(g.a,{className:"delete-icon",onClick:function(){u.collection("posts").doc(a).collection("comments").doc(t).delete().then(console.log(t))}})):c.a.createElement(c.a.Fragment,null))},C=a(27),U=Object(n.forwardRef)((function(e,t){var a=e.username,o=e.postId,l=e.imageUrl,i=e.caption,m=e.curUserName,p=Object(n.useState)([]),d=Object(r.a)(p,2),f=d[0],h=d[1],b=Object(n.useState)(""),_=Object(r.a)(b,2),O=_[0],S=_[1],U=Object(n.useState)("/static/images/avatar/1.jpg"),x=Object(r.a)(U,2),I=x[0],L=x[1],A=Object(n.useState)(),B=Object(r.a)(A,2),F=B[0],D=B[1],T=Object(n.useState)(),R=Object(r.a)(T,2),W=R[0],H=R[1];Object(n.useEffect)((function(){u.collection("avatars").doc(a).collection("avatarUrls").orderBy("timestamp","desc").onSnapshot((function(e){e.empty?console.log("No avatar"):L(e.docs[0].data().avatarUrl)})),u.collection("posts").doc(o).collection("likes").doc(m).get().then((function(e){e.exists?D(!0):D(!1)})),u.collection("posts").doc(o).collection("likes").onSnapshot((function(e){H(e.docs.length)}))}),[]),Object(n.useEffect)((function(){var e;return o&&(e=u.collection("posts").doc(o).collection("comments").onSnapshot((function(e){h(e.docs.map((function(e){return{id:e.id,comment:e.data()}})))}))),function(){e()}}),[o]);return c.a.createElement("div",{className:"post",ref:t},c.a.createElement("div",{className:"post__header"},c.a.createElement("div",{className:"post__meta"},c.a.createElement(C.b,{to:"/users/".concat(a)},c.a.createElement(s.a,{className:"post__avatar",alt:a,src:I})),c.a.createElement(C.b,{to:"/users/".concat(a),style:{color:"inherit",textDecoration:"none"}},c.a.createElement("h3",null,a))),c.a.createElement("div",{className:"post__option"},m&&m===a?c.a.createElement(k.a,{color:"primary","aria-label":"upload picture",component:"span",className:"post__delete",onClick:function(){u.collection("posts").doc(o).collection("comments").onSnapshot((function(e){e.docs.map((function(e){e.ref.delete()}))})),u.collection("posts").doc(o).delete(),u.collection("users").doc(a).collection("postIds").doc(o).delete()}},c.a.createElement(g.a,{style:{fontSize:20},className:"delete-icon"})):c.a.createElement(c.a.Fragment,null))),l?""===l.trim()?c.a.createElement(c.a.Fragment,null):c.a.createElement("img",{className:"post__image",src:l,alt:"post"}):c.a.createElement(c.a.Fragment,null),i?c.a.createElement("h4",{className:"post__text"},c.a.createElement(C.b,{to:"/users/".concat(a),style:{color:"inherit",textDecoration:"none"}},a)," ",c.a.createElement("span",{className:"post__caption"},i)):c.a.createElement(c.a.Fragment,null),c.a.createElement("div",{className:"post__button__row"},c.a.createElement("div",{className:"post__button__row__left"},c.a.createElement(k.a,{onClick:function(e){e.preventDefault(),null!=F&&(F?(u.collection("posts").doc(o).collection("likes").doc(m).delete(),D(!1)):(u.collection("posts").doc(o).collection("likes").doc(m).set({liked:!0}),D(!0)))}},F?c.a.createElement(v.a,null):c.a.createElement(E.a,null)),c.a.createElement(k.a,{href:"/posts/".concat(o)},c.a.createElement(j.a,null)),c.a.createElement(k.a,null,c.a.createElement(N.a,null))),c.a.createElement("div",{className:"post__button__row__left"},c.a.createElement(k.a,null,c.a.createElement(y.a,null)))),c.a.createElement("div",{className:"post__comments"},f.map((function(e){var t=e.id,a=e.comment;return console.log("Comment id ",t),console.log("Commnet made by ",a.username),c.a.createElement(w,{key:t,commentId:t,postId:o,curUserName:m,username:a.username,text:a.text})}))),W>0?c.a.createElement("div",{className:"post__liked_by"},"Liked by ",W):c.a.createElement(c.a.Fragment,null),m&&c.a.createElement("form",{className:"post__commentBox"},c.a.createElement("input",{className:"post__input",type:"text",placeholder:"Add a comment...",value:O,onChange:function(e){return S(e.target.value)}}),c.a.createElement("button",{disabled:!O,className:"post__button",type:"submit",onClick:function(e){e.preventDefault(),u.collection("posts").doc(o).collection("comments").add({text:O,username:m}),S("")}},"Post")))})),x=(a(95),a(121)),I=a(123),L=a(124),A=a(122);a(96);var B=function(e){var t=e.user,a=Object(n.useState)((function(){return{height:"300px",top:"".concat(50,"%"),left:"".concat(50,"%"),transform:"translate(-".concat(50,"%, -").concat(50,"%)")}})),o=Object(r.a)(a,1)[0],l=Object(n.useState)(!1),i=Object(r.a)(l,2),p=i[0],f=i[1],g=Object(x.a)((function(e){return{paper:{position:"absolute",width:400,height:200,backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}))(),h=Object(n.useState)(null),E=Object(r.a)(h,2),b=E[0],v=E[1],_=Object(n.useState)("/static/images/avatar/1.jpg"),j=Object(r.a)(_,2),O=j[0],N=j[1],S=Object(n.useState)(0),y=Object(r.a)(S,2),w=y[0],C=y[1];return u.collection("avatars").doc(t.displayName).collection("avatarUrls").orderBy("timestamp","desc").limit(1).get().then((function(e){e.empty?console.log("No avatar"):e.docs.map((function(e){N(e.data().avatarUrl)}))})),c.a.createElement("div",null,c.a.createElement(k.a,{onClick:function(){f(!0)}},c.a.createElement(s.a,{className:"app__headerAvatar",alt:t.displayName,src:O})),c.a.createElement(I.a,{open:p,onClose:function(){return f(!1)}},c.a.createElement("div",{style:o,className:g.paper},c.a.createElement("form",{className:"app__setAvatar"},c.a.createElement("div",{className:"avatar"},c.a.createElement("progress",{className:"avatarupload__progress",value:w,max:"100"}),c.a.createElement("div",null,c.a.createElement("input",{type:"file",onChange:function(e){e.target.files[0]&&v(e.target.files[0])}}),c.a.createElement(A.a,{className:"avatarupload__button",onClick:function(){b&&d.ref("avatars/".concat(b.name)).put(b).on("state_changed",(function(e){var t=Math.round(e.bytesTransferred/e.totalBytes*100);C(t)}),(function(e){console.log(e)}),(function(){d.ref("avatars").child(b.name).getDownloadURL().then((function(e){N(e),console.log(e),u.collection("avatars").doc(t.displayName).collection("avatarUrls").add({avatarUrl:e,timestamp:m.a.firestore.FieldValue.serverTimestamp()}),C(0),v(null),f(!1)}))}))}},"Set a profile image...")))))))};function F(){return{height:"300px",top:"".concat(50,"%"),left:"".concat(50,"%"),transform:"translate(-".concat(50,"%, -").concat(50,"%)")}}var D=Object(x.a)((function(e){return{paper:{position:"absolute",width:400,height:200,backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}));var T=function(e){var t=e.setHomeUserName,a=D(),o=Object(n.useState)(F),l=Object(r.a)(o,1)[0],s=Object(n.useState)(!1),i=Object(r.a)(s,2),m=i[0],d=i[1],f=Object(n.useState)(!1),g=Object(r.a)(f,2),h=g[0],E=g[1],b=Object(n.useState)(""),v=Object(r.a)(b,2),_=v[0],j=v[1],O=Object(n.useState)(""),N=Object(r.a)(O,2),S=N[0],y=N[1],k=Object(n.useState)(""),w=Object(r.a)(k,2),U=w[0],x=w[1],T=Object(n.useState)(null),R=Object(r.a)(T,2),W=R[0],H=R[1];return Object(n.useEffect)((function(){var e=p.onAuthStateChanged((function(e){console.log("Auth State Change."),e?(H(e),e.displayName?(console.log(e.displayName),console.log("Signed in"),t(e.displayName)):console.log("New user signed in")):(H(null),t(null))}));return function(){e()}}),[W,_]),c.a.createElement("div",{className:"header"},c.a.createElement(I.a,{open:m,onClose:function(){return d(!1)}},c.a.createElement("div",{style:l,className:a.paper},c.a.createElement("form",{className:"home__login"},c.a.createElement("center",null,c.a.createElement("img",{className:"home__headerImage",src:"capThisLogo.png",alt:""})),c.a.createElement(L.a,{placeholder:"email",type:"text",value:S,onChange:function(e){return y(e.target.value)}}),c.a.createElement(L.a,{placeholder:"password",type:"password",value:U,onChange:function(e){return x(e.target.value)}}),c.a.createElement(A.a,{onClick:function(e){e.preventDefault(),p.signInWithEmailAndPassword(S,U).then((function(e){t(e.user.displayName)})).catch((function(e){return alert(e.message)})),d(!1)}},"Login")))),c.a.createElement(I.a,{open:h,onClose:function(){return E(!1)}},c.a.createElement("div",{style:l,className:a.paper},c.a.createElement("form",{className:"home__login"},c.a.createElement("center",null,c.a.createElement("img",{className:"home__headerImage",src:"capThisLogo.png",alt:""})),c.a.createElement(L.a,{type:"text",placeholder:"username",value:_,onChange:function(e){return j(e.target.value)}}),c.a.createElement(L.a,{placeholder:"email",type:"text",value:S,onChange:function(e){return y(e.target.value)}}),c.a.createElement(L.a,{placeholder:"password",type:"password",value:U,onChange:function(e){return x(e.target.value)}}),c.a.createElement(A.a,{onClick:function(e){e.preventDefault(),console.log("New Register"),p.createUserWithEmailAndPassword(S,U).then((function(e){return e.user.updateProfile({displayName:_})})).then((function(){u.collection("users").doc(p.currentUser.displayName).set({username:p.currentUser.displayName,uid:p.currentUser.uid}),t(p.currentUser.displayName)})).catch((function(e){return alert(e.message)})),E(!1)}},"Register")))),c.a.createElement("div",{className:"home__header"},c.a.createElement(C.b,{to:"/"}," ",c.a.createElement("img",{className:"home__headerImage",src:"capThisLogo.png",alt:""})),(null===W||void 0===W?void 0:W.displayName)?c.a.createElement("div",{className:"home__headerRight"},c.a.createElement(A.a,{onClick:function(){p.signOut(),console.log("SIGN OUT!")}},"Logout"),c.a.createElement(B,{user:W})):c.a.createElement("form",{className:"home__loginHome"},c.a.createElement(A.a,{onClick:function(){return d(!0)}},"Login"),c.a.createElement(A.a,{onClick:function(){return E(!0)}},"Sign Up"))))},R=(a(97),a(125)),W=function(e){var t=e.username,a=Object(n.useState)(null),o=Object(r.a)(a,2),l=o[0],s=o[1],i=Object(n.useState)(""),p=Object(r.a)(i,2),f=(p[0],p[1]),g=Object(n.useState)(0),h=Object(r.a)(g,2),E=h[0],b=h[1],v=Object(n.useState)(""),_=Object(r.a)(v,2),j=_[0],O=_[1];return c.a.createElement("div",{className:"imageupload"},c.a.createElement("progress",{className:"imageupload__progress",value:E,max:"100"}),c.a.createElement(L.a,{placeholder:"Enter a caption",value:j,onChange:function(e){return O(e.target.value)}}),c.a.createElement("div",null,c.a.createElement("input",{type:"file",onChange:function(e){e.target.files[0]&&s(e.target.files[0])}}),c.a.createElement(A.a,{className:"imageupload__button",onClick:function(){if(l){var e=Object(R.a)().concat("-",l.name);d.ref("images/".concat(e)).put(l).on("state_changed",(function(e){var t=Math.round(e.bytesTransferred/e.totalBytes*100);b(t)}),(function(e){console.log(e)}),(function(){d.ref("images").child(e).getDownloadURL().then((function(e){f(e),u.collection("posts").add({imageUrl:e,caption:j,username:t,timestamp:m.a.firestore.FieldValue.serverTimestamp()}).then((function(e){u.collection("users").doc(t).collection("postIds").doc(e.id).set({postId:e.id})})),b(0),O(""),s(null)}))}))}else""!==j.trim()&&(u.collection("posts").add({caption:j,username:t,timestamp:m.a.firestore.FieldValue.serverTimestamp()}).then((function(e){u.collection("users").doc(t).collection("postIds").doc(e.id).set({postId:e.id})})),O(""))}},"Upload")),c.a.createElement("br",null))},H=a(64);function P(){return{height:"300px",top:"".concat(50,"%"),left:"".concat(50,"%"),transform:"translate(-".concat(50,"%, -").concat(50,"%)")}}var z=Object(x.a)((function(e){return{paper:{position:"absolute",width:400,height:200,backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}));var M=function(){z();var e=Object(n.useState)(P),t=(Object(r.a)(e,1)[0],Object(n.useState)([])),a=Object(r.a)(t,2),o=a[0],l=a[1],s=Object(n.useState)([]),i=Object(r.a)(s,2),m=i[0],p=i[1],d=Object(n.useState)(""),f=Object(r.a)(d,2),g=f[0],h=f[1],E=Object(n.useState)(""),b=Object(r.a)(E,2),v=(b[0],b[1],Object(n.useState)("")),_=Object(r.a)(v,2),j=(_[0],_[1],Object(n.useState)(!1)),O=Object(r.a)(j,2),N=(O[0],O[1],Object(n.useState)(!1)),S=Object(r.a)(N,2),y=(S[0],S[1],Object(n.useState)(!1)),k=Object(r.a)(y,2);return k[0],k[1],Object(n.useEffect)((function(){console.log("username changed to ",g),g?u.collection("users").doc(g).collection("postIds").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(e.id)})),p(t)})):p([])}),[g]),Object(n.useEffect)((function(){console.log(m),m.length>0&&u.collection("posts").where("__name__","in",m).onSnapshot((function(e){var t=[];e.forEach((function(e){t.push({id:e.id,post:e.data()})})),l(t)}))}),[m]),c.a.createElement("div",{className:"home"},c.a.createElement(T,{setHomeUserName:h}),c.a.createElement("div",{className:"home__posts"},c.a.createElement("div",{className:"home__postsLeft"},c.a.createElement(H.a,null,o.map((function(e){var t=e.id,a=e.post;return c.a.createElement(U,{key:t,postId:t,username:a.username,caption:a.caption,imageUrl:a.imageUrl,curUserName:g})}))))),g?c.a.createElement("div",{className:"home__upload"},c.a.createElement(W,{username:g})):c.a.createElement("center",null,c.a.createElement("h3",null,"Login to upload")))};var V=function(){return c.a.createElement("div",null,c.a.createElement(T,{setHomeUser:function(){return null}}),"404")};var G=function(e){var t=Object(n.useState)(),a=Object(r.a)(t,2),o=a[0],l=(a[1],{});return c.a.createElement("div",null,c.a.createElement(T,{setHomeUserName:function(){return null}}),c.a.createElement(U,{postId:e.params.postId,username:l.username,caption:l.caption,imageUrl:l.imageUrl,curUserName:o}))};var J=function(e){return c.a.createElement("div",null,e.match.params.userId)},Q=a(8);var X=function(){return c.a.createElement(C.a,null,c.a.createElement(Q.c,null,c.a.createElement(Q.a,{exact:!0,path:"/",component:M}),c.a.createElement(Q.a,{exact:!0,path:"/posts/:postId",component:G}),c.a.createElement(Q.a,{exact:!0,path:"/users/:userId",component:J}),c.a.createElement(Q.a,{component:V})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(X,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[69,1,2]]]);
//# sourceMappingURL=main.4c29136c.chunk.js.map